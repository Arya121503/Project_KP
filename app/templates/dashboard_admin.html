<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Admin | Telkom Aset</title>

    <!-- Google Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Custom Dashboard CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/dashAdmin.css') }}"
    />

    <!-- Custom Telkom Color Scheme -->
    <style>
      :root {
        --telkom-red: #DC143C;
        --telkom-dark: #8B0000;
        --telkom-light: rgba(220, 20, 60, 0.1);
        --color-info-dark: #7d8da1;
        --border-radius-1: 0.4rem;
      }

      .analyse .sales .status .progresss svg circle:nth-child(1) {
        stroke: var(--telkom-red);
      }

      .analyse .visits .status .progresss svg circle:nth-child(1) {
        stroke: var(--telkom-red);
      }

      .analyse .searches .status .progresss svg circle:nth-child(1) {
        stroke: var(--telkom-red);
      }
      
      /* Prediction Results Styling from manajemen_prediksi_harga_aset.html */
      .prediction-results {
          background: #fff;
          border-radius: 10px;
          box-shadow: 0 4px 25px rgba(0, 0, 0, 0.1);
          overflow: hidden;
      }
      
      .prediction-item {
          padding: 15px;
          border-bottom: 1px solid #eee;
          transition: all 0.3s ease;
      }
      
      .prediction-value {
          font-size: 1.25rem;
          font-weight: 700;
          color: var(--telkom-red);
      }
      
      .prediction-confidence {
          font-size: 0.9rem;
          color: #28a745;
      }
      
      /* Empty State Styling */
      .empty-state {
          padding: 30px;
          text-align: center;
      }
      
      .empty-state i {
          font-size: 4rem;
          color: #dee2e6;
          margin-bottom: 20px;
      }
      
      .empty-state h4 {
          font-weight: 600;
          margin-bottom: 10px;
      }
      
      .empty-state p {
          color: #6c757d;
      }

      /* Sidebar Menu Styling */
      .sidebar a {
        display: flex;
        align-items: center;
        color: var(--color-info-dark);
        height: 3.7rem;
        gap: 1rem;
        position: relative;
        margin-left: 2rem;
      }

      /* Submenu Styling */
      .submenu {
        background-color: rgba(0, 0, 0, 0.05);
        margin-left: 0;
        border-left: 3px solid var(--telkom-red);
      }

      .submenu-item {
        margin-left: 3rem !important;
        height: 3rem !important;
        font-size: 0.9rem;
        background-color: transparent;
      }

      .submenu-item h3 {
        font-size: 0.9rem;
        font-weight: 500;
      }

      .submenu-item:hover {
        background-color: var(--telkom-light) !important;
        color: var(--telkom-red) !important;
        margin-left: 3.5rem !important;
      }

      .dropdown-toggle::after {
        display: none;
      }

      .dropdown-toggle .material-icons-sharp:last-child {
        transition: transform 0.3s ease;
      }

      .dropdown-toggle[aria-expanded="true"] .material-icons-sharp:last-child {
        transform: rotate(180deg);
      }
      .sidebar a span {
        transition: all 0.3s ease;
        text-decoration: none;
        border-radius: var(--border-radius-1);
      }

      .sidebar a:hover {
        background: var(--telkom-light);
        color: var(--telkom-red) !important;
        transform: translateX(4px);
        margin-right: 1rem;
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.1);
      }

      .sidebar a:hover span,
      .menu-link:hover span {
        margin-left: 0.6rem;
        transition: all 0.3s ease;
        color: var(--telkom-red) !important;
      }

      .sidebar a.active,
      .menu-link.active {
        background: var(--telkom-red);
        color: white !important;
        position: relative;
        margin-right: 1rem;
        box-shadow: 0 4px 12px rgba(220, 20, 60, 0.2);
      }

      .sidebar a.active::before,
      .menu-link.active::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 60%;
        background: var(--telkom-dark);
        border-radius: 0 3px 3px 0;
      }

      .menu-link.active {
        background: var(--telkom-red);
        color: white !important;
        position: relative;
      }

      .menu-link.active::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 60%;
        background: var(--telkom-dark);
        border-radius: 0 3px 3px 0;
      }

      .card:hover {
        box-shadow: 0 8px 25px rgba(220, 20, 60, 0.15);
        transform: translateY(-2px);
        transition: all 0.3s ease;
      }

      .btn-outline-danger:hover,
      .menu-link-external:hover,
      .quick-action-btn:hover {
        background-color: var(--telkom-red) !important;
        border-color: var(--telkom-red) !important;
        color: white !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(220, 20, 60, 0.3);
        transition: all 0.3s ease;
      }

      /* Ensure all quick action buttons have same hover effect */
      .btn-outline-danger:hover i,
      .btn-outline-danger:hover strong,
      .btn-outline-danger:hover small,
      .menu-link-external:hover i,
      .menu-link-external:hover strong,
      .menu-link-external:hover small,
      .quick-action-btn:hover i,
      .quick-action-btn:hover strong,
      .quick-action-btn:hover small {
        color: white !important;
      }

      .btn-outline-danger,
      .menu-link-external,
      .quick-action-btn {
        transition: all 0.3s ease;
      }

      /* Force consistent hover for all quick action buttons */
      a.btn.btn-outline-danger:hover,
      a.menu-link-external:hover,
      a.quick-action-btn:hover {
        background-color: var(--telkom-red) !important;
        border-color: var(--telkom-red) !important;
        color: white !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 15px rgba(220, 20, 60, 0.3) !important;
      }

      /* Ensure all text elements turn white on hover */
      a.btn.btn-outline-danger:hover *,
      a.menu-link-external:hover *,
      a.quick-action-btn:hover * {
        color: white !important;
      }

      /* Override Bootstrap's default btn-outline-danger hover */
      .btn-outline-danger:not(:disabled):not(.disabled):hover {
        background-color: var(--telkom-red) !important;
        border-color: var(--telkom-red) !important;
        color: white !important;
      }

      /* Ensure all sidebar links have consistent hover */
      .sidebar a:not(.active):hover,
      .menu-link:not(.active):hover {
        background: var(--telkom-light) !important;
        color: var(--telkom-red) !important;
        transform: translateX(4px);
        margin-right: 1rem;
        box-shadow: 0 2px 8px rgba(220, 20, 60, 0.1);
        transition: all 0.3s ease;
      }

      .sidebar a:not(.active):hover h3,
      .menu-link:not(.active):hover h3 {
        color: var(--telkom-red) !important;
      }

      .text-telkom {
        color: var(--telkom-red) !important;
      }

      .bg-telkom {
        background-color: var(--telkom-red) !important;
      }

      .border-telkom {
        border-color: var(--telkom-red) !important;
      }

      .alert-info {
        background-color: var(--telkom-light);
        border-color: var(--telkom-red);
        color: var(--telkom-dark);
      }

      .alert-success {
        background-color: #d4edda;
        border-color: #28a745;
        color: #155724;
      }

      .navbar-logo h2 .danger {
        color: var(--telkom-red) !important;
        font-weight: bold;
      }

      /* Progress circles styling */
      .analyse .progresss svg circle {
        fill: none;
        stroke-width: 10;
        stroke-linecap: round;
        transform: translate(5px, 5px);
      }

      .analyse .progresss svg circle:nth-child(2) {
        stroke-dasharray: 200;
        stroke-dashoffset: 50;
        stroke: var(--telkom-red);
      }

      /* Username link styling */
      .username-link {
        color: inherit;
        text-decoration: none;
        transition: color 0.3s ease;
      }

      .username-link:hover {
        color: var(--telkom-red);
        text-decoration: underline;
      }

      /* Ensure proper color in dark mode */
      [data-theme="dark"] .username-link {
        color: var(--color-white, #ffffff);
      }

      [data-theme="dark"] .username-link:hover {
        color: var(--telkom-red);
      }
    </style>
  </head>
  <body>
    <!-- TOP NAVBAR -->
    <nav class="top-navbar">
      <div class="navbar-content">
        <div class="navbar-left">
          <button id="menu-btn" class="menu-toggle">
            <span class="material-icons-sharp">menu</span>
          </button>
          <button id="sidebar-toggle" class="sidebar-toggle">
            <span class="material-icons-sharp">menu_open</span>
          </button>
          <div class="navbar-logo">
            <img
              src="{{ url_for('static', filename='img/telkomLogo.png') }}"
              alt="Telkom Logo"
            />
            <h2>Telkom<span class="danger">Aset</span></h2>
          </div>
        </div>

        <div class="navbar-right">
          <div class="dark-mode">
            <span class="material-icons-sharp active">light_mode</span>
            <span class="material-icons-sharp">dark_mode</span>
          </div>
          <div class="profile">
            <div class="info">
              <p>
                Hey,
                <b
                  ><a href="#" class="username-link" data-target="edit-profil"
                    >{{ session.user_name or 'Admin' }}</a
                  ></b
                >
              </p>
              <small class="text-muted">Admin</small>
            </div>
            <div class="profile-photo">
              <img src="{{ url_for('static', filename='img/profile.jpg') }}" />
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div class="container">
      <!-- SIDEBAR -->
      <aside>
        <div class="sidebar-content">
          <div class="close" id="close-btn">
            <span class="material-icons-sharp">close</span>
          </div>

          <div class="sidebar">
            <a href="#" class="menu-link active" data-target="dashboard-home">
              <span class="material-icons-sharp">dashboard</span>
              <h3>Dashboard</h3>
            </a>
            <a href="#" class="menu-link" data-target="visualisasi">
              <span class="material-icons-sharp">insights</span>
              <h3>Visualisasi Data</h3>
            </a>
            
            <a href="#" class="menu-link" data-target="manajemen_prediksi">
              <span class="material-icons-sharp">analytics</span>
              <h3>Manajemen Prediksi Harga Aset</h3>
            </a>
            
            <a href="#" class="menu-link" data-target="notifikasi">
              <span class="material-icons-sharp">notifications</span>
              <h3>Notifikasi</h3>
            </a>
            <a href="{{ url_for('main.logout_user') }}">
              <span class="material-icons-sharp">logout</span>
              <h3>Logout</h3>
            </a>
          </div>
        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <main>
        <!-- Dashboard Utama -->
        <section id="dashboard-home" class="content-section active">
          <h1>Dashboard Utama Admin</h1>
          <p class="text-muted mb-4">
            Ringkasan lengkap data prediksi properti Telkom
          </p>

          <!-- Statistik Utama -->
          <div class="analyse">
            <div class="sales">
              <div class="status">
                <div class="info">
                  <h3>Total Prediksi</h3>
                  <h1>{{ stats.total_properties or 0 }}</h1>
                  <small>Data Properti (Hasil Prediksi ML)</small>
                </div>
                <div class="progresss">
                  <svg><circle cx="38" cy="38" r="36"></circle></svg>
                  <div class="percentage"><p>100%</p></div>
                </div>
              </div>
            </div>
            <div class="visits">
              <div class="status">
                <div class="info">
                  <h3>Harga Rata-rata (Prediksi)</h3>
                  <h1>Rp {{ "{:,.0f}".format(stats.avg_price or 0) }}</h1>
                  <small>Per Properti (Prediksi ML)</small>
                </div>
                <div class="progresss">
                  <svg><circle cx="38" cy="38" r="36"></circle></svg>
                  <div class="percentage"><p>ML</p></div>
                </div>
              </div>
            </div>
            <div class="searches">
              <div class="status">
                <div class="info">
                  <h3>Harga Rata-rata (Real)</h3>
                  <h1>Rp {{ "{:,.0f}".format(stats.avg_real_price or 0) }}</h1>
                  <small>Per Properti (Ditetapkan Admin)</small>
                </div>
                <div class="progresss">
                  <svg><circle cx="38" cy="38" r="36"></circle></svg>
                  <div class="percentage"><p>Real</p></div>
                </div>
              </div>
            </div>
            <div class="searches">
              <div class="status">
                <div class="info">
                  <h3>Total Pengguna</h3>
                  <h1>{{ stats.total_users or 0 }}</h1>
                  <small>Jumlah Pengguna Terdaftar</small>
                </div>
                <div class="progresss">
                  <svg><circle cx="38" cy="38" r="36"></circle></svg>
                  <div class="percentage"><p><i class="fas fa-users"></i></p></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="row mt-4">
            <div class="col-12">
              <h3 class="mb-3">Menu Utama</h3>
            </div>
            <!-- Quick action buttons removed as requested -->
          </div>

          <!-- Ringkasan Data Aset -->
          <div class="row mt-4">
            <div class="col-12">
              <h3 class="mb-3">Ringkasan Data Aset</h3>
            </div>
            <div class="col-md-6 mb-4">
              <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-success text-white">
                  <h5 class="mb-0">
                    <i class="fas fa-map me-2"></i>Data Tanah
                  </h5>
                </div>
                <div class="card-body">
                  <div class="row text-center">
                    <div class="col-4">
                      <h3 class="text-success">
                        {{ stats_tanah[0] if stats_tanah and stats_tanah[0] else 0 }}
                      </h3>
                      <small class="text-muted">Total Prediksi</small>
                    </div>
                    <div class="col-4">
                      <h6 class="text-success">
                        Rp {{ "{:,.0f}".format(stats_tanah[1] if stats_tanah and stats_tanah[1] else 0) }}
                      </h6>
                      <small class="text-muted">Rata-rata Prediksi</small>
                    </div>
                    <div class="col-4">
                      <h6 class="text-info">
                        Rp {{ "{:,.0f}".format(stats_tanah_real[1] if stats_tanah_real and stats_tanah_real[1] else 0) }}
                      </h6>
                      <small class="text-muted">Rata-rata Real</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-6 mb-4">
              <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-danger text-white">
                  <h5 class="mb-0">
                    <i class="fas fa-building me-2"></i>Data Bangunan+Tanah
                  </h5>
                </div>
                <div class="card-body">
                  <div class="row text-center">
                    <div class="col-4">
                      <h3 class="text-danger">
                        {{ stats_bangunan[0] if stats_bangunan and stats_bangunan[0] else 0 }}
                      </h3>
                      <small class="text-muted">Total Prediksi</small>
                    </div>
                    <div class="col-4">
                      <h6 class="text-danger">
                        Rp {{ "{:,.0f}".format(stats_bangunan[1] if stats_bangunan and stats_bangunan[1] else 0) }}
                      </h6>
                      <small class="text-muted">Rata-rata Prediksi</small>
                    </div>
                    <div class="col-4">
                      <h6 class="text-primary">
                        Rp {{ "{:,.0f}".format(stats_bangunan_real[1] if stats_bangunan_real and stats_bangunan_real[1] else 0) }}
                      </h6>
                      <small class="text-muted">Rata-rata Real</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Visualisasi Data -->
        <section id="visualisasi" class="content-section">
          <div class="p-4">
            <h1 class="fw-bold mb-3">
              <i class="fas fa-chart-area me-2"></i>Visualisasi Data Properti
            </h1>
            <p class="text-muted mb-4">
              Analisis lengkap data properti dengan berbagai jenis visualisasi
              dan insight
            </p>

            <!-- Quick Stats Overview -->
            <div class="row g-4 mb-4">
              <div class="col-md-3 col-sm-6">
                <div class="card text-center shadow-sm border-0">
                  <div class="card-body">
                    <i class="fas fa-chart-line text-danger mb-2 display-6"></i>
                    <h4 id="avgPrice">
                      <i class="fas fa-spinner fa-spin"></i>
                    </h4>
                    <small class="text-muted">Harga Rata-rata</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6">
                <div class="card text-center shadow-sm border-0">
                  <div class="card-body">
                    <i class="fas fa-arrow-up text-info mb-2 display-6"></i>
                    <h4 id="maxPrice">
                      <i class="fas fa-spinner fa-spin"></i>
                    </h4>
                    <small class="text-muted">Harga Tertinggi</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6">
                <div class="card text-center shadow-sm border-0">
                  <div class="card-body">
                    <i
                      class="fas fa-arrow-down text-warning mb-2 display-6"
                    ></i>
                    <h4 id="minPrice">
                      <i class="fas fa-spinner fa-spin"></i>
                    </h4>
                    <small class="text-muted">Harga Terendah</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6">
                <div class="card text-center shadow-sm border-0">
                  <div class="card-body">
                    <i class="fas fa-home text-secondary mb-2 display-6"></i>
                    <h4 id="totalAssets">
                      <i class="fas fa-spinner fa-spin"></i>
                    </h4>
                    <small class="text-muted">Total Aset</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Refresh Button -->
            <div class="row mb-3">
              <div class="col-12">
                <button
                  class="btn btn-success me-2"
                  onclick="window.refreshVisualizationData ? window.refreshVisualizationData() : (window.visualizationDashboard && window.visualizationDashboard.loadAllData())"
                >
                  <i class="fas fa-sync-alt me-2"></i>Refresh Data
                </button>
                <span class="badge bg-success me-2" id="dataStatus">
                  <i class="fas fa-circle me-1"></i>Real-time
                </span>
                <small class="text-muted">
                  <i class="fas fa-clock me-1"></i>Data akan terupdate otomatis
                  setelah admin menambahkan data baru
                </small>
              </div>
            </div>

            <!-- Filter Controls -->
            <div class="card shadow-sm border-0 mb-4">
              <div class="card-header bg-light">
                <h6 class="mb-0">
                  <i class="fas fa-sliders-h me-2"></i>Filter & Kontrol
                  Visualisasi
                </h6>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-2">
                    <label class="form-label">Jenis Chart</label>
                    <select class="form-select" id="chartType">
                      <option value="bar">Bar Chart</option>
                      <option value="line">Line Chart</option>
                      <option value="pie">Pie Chart</option>
                      <option value="doughnut">Doughnut</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Tipe Data</label>
                    <select class="form-select" id="dataType">
                      <option value="prediksi">Data Prediksi</option>
                      <option value="real">Data Real</option>
                      <option value="perbandingan">Perbandingan</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Data Source</label>
                    <select class="form-select" id="dataSource">
                      <option value="both">Semua Data</option>
                      <option value="tanah">Data Tanah</option>
                      <option value="bangunan">Data Bangunan</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Group By</label>
                    <select class="form-select" id="groupBy">
                      <option value="location">Lokasi</option>
                      <option value="type">Jenis Aset</option>
                      <option value="price_range">Range Harga</option>
                      <option value="certificate">Sertifikat</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Metrik</label>
                    <select class="form-select" id="metric">
                      <option value="avgPrice">Harga Rata-rata</option>
                      <option value="totalValue">Total Nilai</option>
                      <option value="count">Jumlah Aset</option>
                      <option value="price_per_sqm">Harga per M²</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Periode</label>
                    <select class="form-select" id="timePeriod">
                      <option value="all">Semua Waktu</option>
                      <option value="month">Bulanan</option>
                      <option value="quarter">Kuartalan</option>
                      <option value="year">Tahunan</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Aksi</label>
                    <button class="btn btn-danger w-100" id="updateChart">
                      <i class="fas fa-sync-alt me-1"></i>Update
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Message for insufficient data -->
            <div id="visualization-message" class="alert alert-warning text-center" style="display: none;">
              <i class="fas fa-info-circle me-2"></i>Tidak cukup data untuk menampilkan visualisasi grafik.
            </div>

            <!-- Main Charts Section -->
            <div id="main-charts-container" class="row g-4 mb-4">
              <!-- Primary Chart -->
              <div class="col-md-8">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-danger text-white">
                    <h6 class="mb-0">
                      <i class="fas fa-chart-bar me-2"></i>Analisis Utama -
                      Distribusi Harga per Kecamatan
                    </h6>
                  </div>
                  <div class="card-body">
                    <canvas id="mainChart" height="350"></canvas>
                  </div>
                </div>
              </div>

              <!-- Property Type Distribution -->
              <div class="col-md-4">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-success text-white">
                    <h6 class="mb-0">
                      <i class="fas fa-pie-chart me-2"></i>Jenis Properti
                    </h6>
                  </div>
                  <div class="card-body">
                    <canvas id="propertyTypeChart" height="350"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Secondary Charts Row -->
            <div class="row g-4 mb-4">
              <!-- Location Analysis -->
              <div class="col-md-6">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                      <i class="fas fa-map-marker-alt me-2"></i>Analisis Lokasi
                    </h6>
                  </div>
                  <div class="card-body">
                    <canvas id="locationChart" height="300"></canvas>
                  </div>
                </div>
              </div>

              <!-- Trend Analysis -->
              <div class="col-md-6">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">
                      <i class="fas fa-chart-line me-2"></i>Trend Harga
                    </h6>
                  </div>
                  <div class="card-body">
                    <canvas id="trendChart" height="300"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Model Performance & Additional Analysis -->
            <div class="row g-4 mb-4">
              <!-- Model Performance -->
              <div class="col-md-6">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">
                      <i class="fas fa-brain me-2"></i>Performa Model ML
                    </h6>
                  </div>
                  <div class="card-body">
                    <div class="row text-center mb-3">
                      <div class="col-4">
                        <div class="d-flex flex-column align-items-center">
                          <small class="text-muted mb-1">Random Forest</small>
                          <h4 class="text-info mb-0">94.2%</h4>
                          <div
                            class="progress mt-2"
                            style="width: 80%; height: 8px"
                          >
                            <div
                              class="progress-bar bg-info"
                              style="width: 94.2%"
                            ></div>
                          </div>
                        </div>
                      </div>
                      <div class="col-4">
                        <div class="d-flex flex-column align-items-center">
                          <small class="text-muted mb-1">XGBoost</small>
                          <h4 class="text-warning mb-0">92.8%</h4>
                          <div
                            class="progress mt-2"
                            style="width: 80%; height: 8px"
                          >
                            <div
                              class="progress-bar bg-warning"
                              style="width: 92.8%"
                            ></div>
                          </div>
                        </div>
                      </div>
                      <div class="col-4">
                        <div class="d-flex flex-column align-items-center">
                          <small class="text-muted mb-1">CatBoost</small>
                          <h4 class="text-success mb-0">93.5%</h4>
                          <div
                            class="progress mt-2"
                            style="width: 80%; height: 8px"
                          >
                            <div
                              class="progress-bar bg-success"
                              style="width: 93.5%"
                            ></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="text-center">
                      <canvas id="modelMetricsChart" height="150"></canvas>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Certificate Analysis -->
              <div class="col-md-6">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0">
                      <i class="fas fa-certificate me-2"></i>Analisis Sertifikat
                    </h6>
                  </div>
                  <div class="card-body">
                    <canvas id="certificateChart" height="200"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Price per SQM Analysis -->
            <div class="row g-4 mb-4">
              <div class="col-md-12">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-dark text-white">
                    <h6 class="mb-0">
                      <i class="fas fa-calculator me-2"></i>Analisis Harga per
                      M²
                    </h6>
                  </div>
                  <div class="card-body">
                    <canvas id="pricePerSqmChart" height="300"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Data Tables & Statistics -->
            <div class="row g-4 mb-4">
              <!-- All Locations Table -->
              <div class="col-md-6">
                <div class="card shadow-sm border-0">
                  <div
                    class="card-header bg-gradient"
                    style="background: linear-gradient(45deg, #dc143c, #ff6b6b)"
                  >
                    <h6 class="mb-0 text-white">
                      <i class="fas fa-map-marker-alt me-2"></i>Semua Kecamatan
                      di Surabaya
                    </h6>
                  </div>
                  <div class="card-body">
                    <div
                      class="table-responsive"
                      style="max-height: 400px; overflow-y: auto"
                    >
                      <table class="table table-hover table-sm">
                        <thead class="table-dark sticky-top">
                          <tr>
                            <th>Rank</th>
                            <th>Kecamatan</th>
                            <th>Rata-rata</th>
                            <th>Jumlah</th>
                          </tr>
                        </thead>
                        <tbody id="topPriceTable">
                          <!-- Data akan diisi oleh JavaScript -->
                          <tr>
                            <td colspan="4" class="text-center">
                              <i class="fas fa-spinner fa-spin"></i> Loading
                              data...
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Statistical Summary -->
              <div class="col-md-6">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                      <i class="fas fa-chart-area me-2"></i>Ringkasan Statistik
                    </h6>
                  </div>
                  <div class="card-body">
                    <div class="row text-center mb-3">
                      <div class="col-6">
                        <small class="text-muted">Std Deviation</small>
                        <h5 class="text-primary">Rp 245M</h5>
                      </div>
                      <div class="col-6">
                        <small class="text-muted">Median</small>
                        <h5 class="text-success">Rp 820M</h5>
                      </div>
                    </div>
                    <div class="row text-center mb-3">
                      <div class="col-6">
                        <small class="text-muted">Range</small>
                        <h5 class="text-warning">Rp 2.35B</h5>
                      </div>
                      <div class="col-6">
                        <small class="text-muted">Variance</small>
                        <h5 class="text-danger">60,025M²</h5>
                      </div>
                    </div>
                    <!-- Growth Indicators -->
                    <div class="mt-3">
                      <div
                        class="d-flex justify-content-between align-items-center mb-2"
                      >
                        <small>Growth Rate (YoY)</small>
                        <span class="badge bg-success">+5.2%</span>
                      </div>
                      <div
                        class="d-flex justify-content-between align-items-center mb-2"
                      >
                        <small>Market Volatility</small>
                        <span class="badge bg-warning">Medium</span>
                      </div>
                      <div
                        class="d-flex justify-content-between align-items-center"
                      >
                        <small>Market Trend</small>
                        <span class="badge bg-info">Bullish</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Export & Custom Reports -->
            <div class="row g-4">
              <div class="col-md-8">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-success text-white">
                    <h6 class="mb-0">
                      <i class="fas fa-download me-2"></i>Export & Laporan
                    </h6>
                  </div>
                  <div class="card-body">
                    <div class="row g-3">
                      <div class="col-md-3">
                        <button class="btn btn-outline-primary w-100">
                          <i class="fas fa-file-excel me-2"></i>Excel
                        </button>
                      </div>
                      <div class="col-md-3">
                        <button class="btn btn-outline-danger w-100">
                          <i class="fas fa-file-pdf me-2"></i>PDF
                        </button>
                      </div>
                      <div class="col-md-3">
                        <button class="btn btn-outline-success w-100">
                          <i class="fas fa-file-csv me-2"></i>CSV
                        </button>
                      </div>
                      <div class="col-md-3">
                        <button class="btn btn-outline-info w-100">
                          <i class="fas fa-image me-2"></i>PNG
                        </button>
                      </div>
                    </div>
                    <div class="mt-3">
                      <button class="btn btn-success me-2" id="generateReport">
                        <i class="fas fa-magic me-2"></i>Generate Custom Report
                      </button>
                      <button class="btn btn-warning" id="scheduleReport">
                        <i class="fas fa-clock me-2"></i>Schedule Report
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">
                      <i class="fas fa-info-circle me-2"></i>Informasi
                    </h6>
                  </div>
                  <div class="card-body">
                    <div class="alert alert-info border-0">
                      <i class="fas fa-lightbulb me-2"></i>
                      <strong>Tips:</strong> Gunakan filter untuk melihat data
                      yang lebih spesifik dan relevan dengan kebutuhan analisis
                      Anda.
                    </div>
                    <div class="text-center">
                      <small class="text-muted">Data terakhir update:</small
                      ><br />
                      <strong id="lastUpdateTime"
                        >{{ current_date or "Loading..." }}</strong
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Aset Disewa -->
        <!-- Content sections removed as requested -->

        <!-- Manajemen Prediksi Harga Aset -->
        <section id="manajemen_prediksi" class="content-section">
          <div class="p-4">
            <h1 class="fw-bold mb-3">
              <i class="fas fa-analytics me-2"></i>Manajemen Prediksi Harga Aset
            </h1>
            <p class="text-muted mb-4">Kelola dan prediksi harga aset properti untuk pelanggan</p>

            <div class="card shadow-sm border-0">
              <div class="card-body p-0">
                <!-- Navigation Tabs -->
                <ul class="nav nav-tabs" id="assetTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <a class="nav-link active" id="tanah-tab" data-bs-toggle="tab" href="#tanah" role="tab">
                      <i class="fas fa-mountain me-2"></i>Tanah
                    </a>
                  </li>
                  <li class="nav-item" role="presentation">
                    <a class="nav-link" id="bangunan-tab" data-bs-toggle="tab" href="#bangunan" role="tab">
                      <i class="fas fa-building me-2"></i>Tanah + Bangunan
                    </a>
                  </li>
                  <li class="nav-item" role="presentation">
                    <a class="nav-link" id="sent-assets-tab" data-bs-toggle="tab" href="#sent-assets" role="tab">
                      <i class="fas fa-paper-plane me-2"></i>Aset Disewakan ke Pelanggan
                    </a>
                  </li>
                  <li class="nav-item" role="presentation">
                    <a class="nav-link" id="rental-prediction-tab" data-bs-toggle="tab" href="#rental-prediction" role="tab">
                      <i class="fas fa-calendar-alt me-2"></i>Prediksi Harga Sewa Bulanan
                    </a>
                  </li>
                </ul>
                
                <!-- Tab Content -->
                <div class="tab-content p-4" id="assetTabsContent">
                  <!-- Tanah Tab -->
                  <div class="tab-pane fade show active" id="tanah" role="tabpanel">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                          <div class="card-header bg-danger text-white">
                            <h5 class="mb-0">Form Prediksi Harga Tanah</h5>
                          </div>
                          <div class="card-body">
                            <form id="tanahForm">
                              <div class="form-group mb-3">
                                <label for="kecamatan">Kecamatan</label>
                                <select class="form-select" id="kecamatan" name="kecamatan" required>
                                  <option value="">Pilih Kecamatan</option>
                                  <option value="Sukomanunggal">Sukomanunggal</option>
                                  <option value="Tandes">Tandes</option>
                                  <option value="Asemrowo">Asemrowo</option>
                                  <option value="Benowo">Benowo</option>
                                  <option value="Pakal">Pakal</option>
                                  <option value="Lakarsantri">Lakarsantri</option>
                                  <option value="Sambikerep">Sambikerep</option>
                                  <option value="Genteng">Genteng</option>
                                  <option value="Tegalsari">Tegalsari</option>
                                  <option value="Bubutan">Bubutan</option>
                                  <option value="Simokerto">Simokerto</option>
                                  <option value="Pabean Cantian">Pabean Cantian</option>
                                  <option value="Semampir">Semampir</option>
                                  <option value="Krembangan">Krembangan</option>
                                  <option value="Bulak">Bulak</option>
                                  <option value="Kenjeran">Kenjeran</option>
                                  <option value="Tambaksari">Tambaksari</option>
                                  <option value="Gubeng">Gubeng</option>
                                  <option value="Rungkut">Rungkut</option>
                                  <option value="Trenggilis">Trenggilis</option>
                                  <option value="Gunung Anyar">Gunung Anyar</option>
                                  <option value="Sukolilo">Sukolilo</option>
                                  <option value="Mulyorejo">Mulyorejo</option>
                                  <option value="Sawahan">Sawahan</option>
                                  <option value="Wonokromo">Wonokromo</option>
                                  <option value="Karangpilang">Karangpilang</option>
                                  <option value="Dukuh Pakis">Dukuh Pakis</option>
                                  <option value="Wiyung">Wiyung</option>
                                  <option value="Gayungan">Gayungan</option>
                                  <option value="Wonocolo">Wonocolo</option>
                                  <option value="Tenggilis Mejoyo">Tenggilis Mejoyo</option>
                                </select>
                              </div>
                              
                              <div class="form-group mb-3">
                                <label for="luas_tanah_m2">Luas Tanah (m²)</label>
                                <input type="number" class="form-control" id="luas_tanah_m2" name="luas_tanah_m2" min="1" required>
                              </div>
                              
                              <div class="form-group mb-3">
                                <label for="jenis_zona">Jenis Zona</label>
                                <select class="form-select" id="jenis_zona" name="jenis_zona" required>
                                  <option value="">Pilih Jenis Zona</option>
                                  <option value="Perumahan">Perumahan</option>
                                  <option value="Komersial">Komersial</option>
                                  <option value="Industri">Industri</option>
                                </select>
                              </div>
                              
                              <div class="form-group mb-3">
                                <label for="aksesibilitas">Aksesibilitas</label>
                                <select class="form-select" id="aksesibilitas" name="aksesibilitas" required>
                                  <option value="">Pilih Aksesibilitas</option>
                                  <option value="Baik">Baik</option>
                                  <option value="Buruk">Buruk</option>
                                </select>
                              </div>
                              
                              <div class="form-group mb-3">
                                <label for="tingkat_keamanan">Tingkat Keamanan</label>
                                <select class="form-select" id="tingkat_keamanan" name="tingkat_keamanan" required>
                                  <option value="">Pilih Tingkat Keamanan</option>
                                  <option value="rendah">Rendah</option>
                                  <option value="tinggi">Tinggi</option>
                                </select>
                              </div>
                              
                              <div class="form-group mb-3">
                                <label for="sertifikat">Jenis Sertifikat</label>
                                <select class="form-select" id="sertifikat" name="sertifikat" required>
                                  <option value="">Pilih Jenis Sertifikat</option>
                                  <option value="SHM">SHM</option>
                                  <option value="HGB">HGB</option>
                                  <option value="Lainnya">Lainnya</option>
                                </select>
                              </div>
                              
                              <button type="button" class="btn btn-danger w-100" onclick="predictTanahPrice()">
                                <i class="fas fa-calculator me-2"></i>Prediksi Harga Tanah
                              </button>
                            </form>
                          </div>
                        </div>
                      </div>
                      
                      <div class="col-md-6">
                        <!-- Prediction Results Card -->
                        <div class="card shadow-sm mb-4" id="tanahPredictionResults" style="display: none;">
                          <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Hasil Prediksi</h5>
                          </div>
                          <div class="card-body" id="tanahPredictionContent">
                            <!-- Content will be populated by JS -->
                          </div>
                          <div class="card-footer bg-light">
                            <button type="button" class="btn btn-success w-100" id="saveTanahPrediction">
                              <i class="fas fa-save me-2"></i>Simpan & Sewakan ke Pelanggan
                            </button>
                          </div>
                        </div>
                        
                        <!-- No Prediction Info -->
                        <div class="card shadow-sm" id="tanahNoPrediction">
                          <div class="card-body text-center py-5">
                            <div class="empty-state">
                              <i class="fas fa-chart-line text-muted mb-3" style="font-size: 4rem;"></i>
                              <h4 class="text-muted">Belum Ada Prediksi</h4>
                              <p class="text-muted">
                                Masukkan data pada form di samping untuk<br>mendapatkan prediksi harga tanah.
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Bangunan Tab -->
                  <div class="tab-pane fade" id="bangunan" role="tabpanel">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                          <div class="card-header bg-danger text-white">
                            <h5 class="mb-0">Form Prediksi Harga Bangunan + Tanah</h5>
                          </div>
                          <div class="card-body">
                            <form id="bangunanForm">
                              <div class="form-group mb-3">
                                <label for="b_kecamatan">Kecamatan</label>
                                <select class="form-select" id="b_kecamatan" name="kecamatan" required>
                                  <option value="">Pilih Kecamatan</option>
                                  <option value="Sukomanunggal">Sukomanunggal</option>
                                  <option value="Tandes">Tandes</option>
                                  <option value="Asemrowo">Asemrowo</option>
                                  <option value="Benowo">Benowo</option>
                                  <option value="Pakal">Pakal</option>
                                  <option value="Lakarsantri">Lakarsantri</option>
                                  <option value="Sambikerep">Sambikerep</option>
                                  <option value="Genteng">Genteng</option>
                                  <option value="Tegalsari">Tegalsari</option>
                                  <option value="Bubutan">Bubutan</option>
                                  <option value="Simokerto">Simokerto</option>
                                  <option value="Pabean Cantian">Pabean Cantian</option>
                                  <option value="Semampir">Semampir</option>
                                  <option value="Krembangan">Krembangan</option>
                                  <option value="Bulak">Bulak</option>
                                  <option value="Kenjeran">Kenjeran</option>
                                  <option value="Tambaksari">Tambaksari</option>
                                  <option value="Gubeng">Gubeng</option>
                                  <option value="Rungkut">Rungkut</option>
                                  <option value="Trenggilis">Trenggilis</option>
                                  <option value="Gunung Anyar">Gunung Anyar</option>
                                  <option value="Sukolilo">Sukolilo</option>
                                  <option value="Mulyorejo">Mulyorejo</option>
                                  <option value="Sawahan">Sawahan</option>
                                  <option value="Wonokromo">Wonokromo</option>
                                  <option value="Karangpilang">Karangpilang</option>
                                  <option value="Dukuh Pakis">Dukuh Pakis</option>
                                  <option value="Wiyung">Wiyung</option>
                                  <option value="Gayungan">Gayungan</option>
                                  <option value="Wonocolo">Wonocolo</option>
                                  <option value="Tenggilis Mejoyo">Tenggilis Mejoyo</option>
                                </select>
                              </div>
                              
                              <div class="row">
                                <div class="col-md-6">
                                  <div class="form-group mb-3">
                                    <label for="b_luas_tanah_m2">Luas Tanah (m²)</label>
                                    <input type="number" class="form-control" id="b_luas_tanah_m2" name="luas_tanah_m2" min="1" required>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group mb-3">
                                    <label for="luas_bangunan_m2">Luas Bangunan (m²)</label>
                                    <input type="number" class="form-control" id="luas_bangunan_m2" name="luas_bangunan_m2" min="1" required>
                                  </div>
                                </div>
                              </div>
                              
                              <div class="row">
                                <div class="col-md-4">
                                  <div class="form-group mb-3">
                                    <label for="jumlah_kamar">Kamar Tidur</label>
                                    <input type="number" class="form-control" id="jumlah_kamar" name="jumlah_kamar" min="0" required>
                                  </div>
                                </div>
                                <div class="col-md-4">
                                  <div class="form-group mb-3">
                                    <label for="jumlah_kamar_mandi">Kamar Mandi</label>
                                    <input type="number" class="form-control" id="jumlah_kamar_mandi" name="jumlah_kamar_mandi" min="0" required>
                                  </div>
                                </div>
                                <div class="col-md-4">
                                  <div class="form-group mb-3">
                                    <label for="jumlah_lantai">Jumlah Lantai</label>
                                    <input type="number" class="form-control" id="jumlah_lantai" name="jumlah_lantai" min="1" required>
                                  </div>
                                </div>
                              </div>
                              
                              <div class="row">
                                <div class="col-md-6">
                                  <div class="form-group mb-3">
                                    <label for="daya_listrik">Daya Listrik (VA)</label>
                                    <select class="form-select" id="daya_listrik" name="daya_listrik" required>
                                      <option value="">Pilih Daya</option>
                                      <option value="900">900 VA</option>
                                      <option value="1300">1300 VA</option>
                                      <option value="2200">2200 VA</option>
                                      <option value="3500">3500 VA</option>
                                      <option value="4400">4400 VA</option>
                                      <option value="5500">5500 VA</option>
                                      <option value="6600">6600 VA</option>
                                      <option value="10600">10600 VA</option>
                                      <option value="13200">13200 VA</option>
                                      <option value="16500">16500 VA</option>
                                    </select>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group mb-3">
                                    <label for="tahun_dibangun">Tahun Dibangun</label>
                                    <input type="number" class="form-control" id="tahun_dibangun" name="tahun_dibangun" min="1900" max="2025" required>
                                  </div>
                                </div>
                              </div>
                              
                              <div class="row">
                                <div class="col-md-6">
                                  <div class="form-group mb-3">
                                    <label for="b_sertifikat">Jenis Sertifikat</label>
                                    <select class="form-select" id="b_sertifikat" name="sertifikat" required>
                                      <option value="">Pilih Jenis Sertifikat</option>
                                      <option value="SHM">SHM</option>
                                      <option value="HGB">HGB</option>
                                      <option value="Lainnya">Lainnya</option>
                                    </select>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group mb-3">
                                    <label for="kondisi_properti">Kondisi Properti</label>
                                    <select class="form-select" id="kondisi_properti" name="kondisi_properti" required>
                                      <option value="">Pilih Kondisi</option>
                                      <option value="Sangat Baik">Sangat Baik</option>
                                      <option value="Baik">Baik</option>
                                      <option value="Cukup">Cukup</option>
                                      <option value="Kurang Baik">Kurang Baik</option>
                                      <option value="Renovasi">Butuh Renovasi</option>
                                    </select>
                                  </div>
                                </div>
                              </div>
                              
                              <div class="row">
                                <div class="col-md-6">
                                  <div class="form-group mb-3">
                                    <label for="b_tingkat_keamanan">Tingkat Keamanan</label>
                                    <select class="form-select" id="b_tingkat_keamanan" name="tingkat_keamanan" required>
                                      <option value="">Pilih Tingkat Keamanan</option>
                                      <option value="rendah">Rendah</option>
                                      <option value="tinggi">Tinggi</option>
                                    </select>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group mb-3">
                                    <label for="b_aksesibilitas">Aksesibilitas</label>
                                    <select class="form-select" id="b_aksesibilitas" name="aksesibilitas" required>
                                      <option value="">Pilih Aksesibilitas</option>
                                      <option value="Baik">Baik</option>
                                      <option value="Buruk">Buruk</option>
                                    </select>
                                  </div>
                                </div>
                              </div>
                              
                              <button type="button" class="btn btn-danger w-100" onclick="predictBangunanPrice()">
                                <i class="fas fa-calculator me-2"></i>Prediksi Harga Bangunan + Tanah
                              </button>
                            </form>
                          </div>
                        </div>
                      </div>
                      
                      <div class="col-md-6">
                        <!-- Prediction Results Card -->
                        <div class="card shadow-sm mb-4" id="bangunanPredictionResults" style="display: none;">
                          <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Hasil Prediksi</h5>
                          </div>
                          <div class="card-body" id="bangunanPredictionContent">
                            <!-- Content will be populated by JS -->
                          </div>
                          <div class="card-footer bg-light">
                            <button type="button" class="btn btn-success w-100" id="saveBangunanPrediction">
                              <i class="fas fa-save me-2"></i>Simpan & Sewakan ke Pelanggan
                            </button>
                          </div>
                        </div>
                        
                        <!-- No Prediction Info -->
                        <div class="card shadow-sm" id="bangunanNoPrediction">
                          <div class="card-body text-center py-5">
                            <div class="empty-state">
                              <i class="fas fa-building text-muted mb-3" style="font-size: 4rem;"></i>
                              <h4 class="text-muted">Belum Ada Prediksi</h4>
                              <p class="text-muted">
                                Masukkan data pada form di samping untuk<br>mendapatkan prediksi harga bangunan + tanah.
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Aset Disewakan Tab -->
                  <div class="tab-pane fade" id="sent-assets" role="tabpanel">
                    <div class="card shadow-sm">
                      <div class="card-body">
                        <div class="row mb-3">
                          <div class="col-md-6">
                            <h5 class="mb-0">Daftar Aset yang Disewakan ke Pelanggan</h5>
                          </div>
                          <div class="col-md-6 text-end">
                            <div class="row">
                              <div class="col-md-6">
                                <select id="filterKecamatan" class="form-select form-select-sm">
                                  <option value="">Semua Kecamatan</option>
                                </select>
                              </div>
                              <div class="col-md-6">
                                <select id="filterStatus" class="form-select form-select-sm">
                                  <option value="">Semua Status</option>
                                  <option value="active">Aktif</option>
                                  <option value="pending">Pending</option>
                                  <option value="expired">Kadaluarsa</option>
                                </select>
                              </div>
                            </div>
                          </div>
                        </div>
                        
                        <div class="table-responsive">
                          <table class="table table-hover">
                            <thead>
                              <tr>
                                <th>Kecamatan</th>
                                <th>Tipe</th>
                                <th>Luas</th>
                                <th>Harga Prediksi</th>
                                <th>Harga Sewa</th>
                                <th>Status</th>
                                <th>Aksi</th>
                              </tr>
                            </thead>
                            <tbody id="sentAssetsTableBody">
                              <!-- Content will be populated by JS -->
                            </tbody>
                          </table>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                          <div>
                            <span id="paginationInfo">Menampilkan 0-0 dari 0 item</span>
                          </div>
                          <ul class="pagination pagination-sm" id="paginationList">
                            <!-- Pagination will be populated by JS -->
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Rental Prediction Tab -->
                  <div class="tab-pane fade" id="rental-prediction" role="tabpanel">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                          <div class="card-header bg-danger text-white">
                            <h5 class="mb-0">Form Prediksi Harga Sewa Bulanan</h5>
                          </div>
                          <div class="card-body">
                            <form id="rentalPredictionForm">
                              <div class="form-group mb-3">
                                <label for="rentalPropertyType">Jenis Properti</label>
                                <select class="form-select" id="rentalPropertyType" name="propertyType" required>
                                  <option value="">Pilih Jenis Properti</option>
                                  <option value="tanah">Tanah</option>
                                  <option value="bangunan">Bangunan + Tanah</option>
                                </select>
                              </div>
                              
                              <div class="form-group mb-3">
                                <label for="rentalKecamatan">Kecamatan</label>
                                <select class="form-select" id="rentalKecamatan" name="kecamatan" required>
                                  <option value="">Pilih Kecamatan</option>
                                  <option value="Sukomanunggal">Sukomanunggal</option>
                                  <option value="Tandes">Tandes</option>
                                  <option value="Asemrowo">Asemrowo</option>
                                  <option value="Benowo">Benowo</option>
                                  <option value="Pakal">Pakal</option>
                                  <option value="Lakarsantri">Lakarsantri</option>
                                  <option value="Sambikerep">Sambikerep</option>
                                  <option value="Genteng">Genteng</option>
                                  <option value="Tegalsari">Tegalsari</option>
                                  <option value="Bubutan">Bubutan</option>
                                  <option value="Simokerto">Simokerto</option>
                                  <option value="Pabean Cantian">Pabean Cantian</option>
                                  <option value="Semampir">Semampir</option>
                                  <option value="Krembangan">Krembangan</option>
                                  <option value="Bulak">Bulak</option>
                                  <option value="Kenjeran">Kenjeran</option>
                                  <option value="Tambaksari">Tambaksari</option>
                                  <option value="Gubeng">Gubeng</option>
                                  <option value="Rungkut">Rungkut</option>
                                  <option value="Trenggilis">Trenggilis</option>
                                  <option value="Gunung Anyar">Gunung Anyar</option>
                                  <option value="Sukolilo">Sukolilo</option>
                                  <option value="Mulyorejo">Mulyorejo</option>
                                  <option value="Sawahan">Sawahan</option>
                                  <option value="Wonokromo">Wonokromo</option>
                                  <option value="Karangpilang">Karangpilang</option>
                                  <option value="Dukuh Pakis">Dukuh Pakis</option>
                                  <option value="Wiyung">Wiyung</option>
                                  <option value="Gayungan">Gayungan</option>
                                  <option value="Wonocolo">Wonocolo</option>
                                  <option value="Tenggilis Mejoyo">Tenggilis Mejoyo</option>
                                </select>
                              </div>
                              
                              <div class="form-group mb-3">
                                <label for="rentalLuasTanah">Luas Tanah (m²)</label>
                                <input type="number" class="form-control" id="rentalLuasTanah" name="luasTanah" min="1" required>
                              </div>
                              
                              <div id="rentalBangunanFields">
                                <div class="form-group mb-3" id="rentalLuasBangunanGroup">
                                  <label for="rentalLuasBangunan">Luas Bangunan (m²)</label>
                                  <input type="number" class="form-control" id="rentalLuasBangunan" name="luasBangunan" min="1">
                                </div>
                                
                                <div class="form-group mb-3">
                                  <label for="rentalKondisiProperti">Kondisi Properti</label>
                                  <select class="form-select" id="rentalKondisiProperti" name="kondisiProperti">
                                    <option value="">Pilih Kondisi</option>
                                    <option value="Sangat Baik">Sangat Baik</option>
                                    <option value="Baik">Baik</option>
                                    <option value="Cukup">Cukup</option>
                                    <option value="Kurang Baik">Kurang Baik</option>
                                    <option value="Renovasi">Butuh Renovasi</option>
                                  </select>
                                </div>
                                
                                <div class="form-group mb-3" id="rentalDayaListrikGroup">
                                  <label for="rentalDayaListrik">Daya Listrik (VA)</label>
                                  <select class="form-select" id="rentalDayaListrik" name="dayaListrik">
                                    <option value="">Pilih Daya</option>
                                    <option value="900">900 VA</option>
                                    <option value="1300">1300 VA</option>
                                    <option value="2200">2200 VA</option>
                                    <option value="3500">3500 VA</option>
                                    <option value="4400">4400 VA</option>
                                    <option value="5500">5500 VA</option>
                                    <option value="6600">6600 VA</option>
                                    <option value="10600">10600 VA</option>
                                    <option value="13200">13200 VA</option>
                                    <option value="16500">16500 VA</option>
                                  </select>
                                </div>
                              </div>
                              
                              <div class="form-group mb-3">
                                <label for="rentalAksesibilitas">Aksesibilitas</label>
                                <select class="form-select" id="rentalAksesibilitas" name="aksesibilitas" required>
                                  <option value="">Pilih Aksesibilitas</option>
                                  <option value="Baik">Baik</option>
                                  <option value="Buruk">Buruk</option>
                                </select>
                              </div>
                              
                              <div class="form-group mb-3">
                                <label for="rentalDurasiSewa">Durasi Sewa (bulan)</label>
                                <select class="form-select" id="rentalDurasiSewa" name="durasiSewa" required>
                                  <option value="">Pilih Durasi</option>
                                  <option value="1">1 bulan</option>
                                  <option value="3">3 bulan</option>
                                  <option value="6">6 bulan</option>
                                  <option value="12">12 bulan</option>
                                  <option value="24">24 bulan</option>
                                  <option value="36">36 bulan</option>
                                </select>
                              </div>
                              
                              <button type="submit" class="btn btn-danger w-100">
                                <i class="fas fa-calculator me-2"></i>Prediksi Harga Sewa
                              </button>
                            </form>
                          </div>
                        </div>
                      </div>
                      
                      <div class="col-md-6">
                        <!-- Rental Prediction Results -->
                        <div class="card shadow-sm mb-4" id="rentalPredictionResults" style="display: none;">
                          <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Hasil Prediksi Harga Sewa</h5>
                          </div>
                          <div class="card-body">
                            <div class="mb-4">
                              <h6 class="text-muted mb-3">Prediksi Berdasarkan Model ML</h6>
                              <div class="row g-3">
                                <div class="col-md-4">
                                  <div class="prediction-item">
                                    <small class="d-block text-muted mb-1">Random Forest</small>
                                    <span class="prediction-value" id="rentalRfResult">Rp 0</span>
                                  </div>
                                </div>
                                <div class="col-md-4">
                                  <div class="prediction-item">
                                    <small class="d-block text-muted mb-1">XGBoost</small>
                                    <span class="prediction-value" id="rentalXgbResult">Rp 0</span>
                                  </div>
                                </div>
                                <div class="col-md-4">
                                  <div class="prediction-item">
                                    <small class="d-block text-muted mb-1">CatBoost</small>
                                    <span class="prediction-value" id="rentalCatResult">Rp 0</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                            
                            <div class="p-4 bg-light rounded">
                              <div class="row">
                                <div class="col-md-7">
                                  <h5 class="mb-0">Harga Sewa Bulanan</h5>
                                  <div class="text-success fs-3 fw-bold" id="rentalEnsembleResult">Rp 0</div>
                                  <p class="small text-muted mt-2 mb-0">*Ensemble dari 3 model ML</p>
                                </div>
                                <div class="col-md-5 border-start ps-4">
                                  <p class="mb-1">Confidence Score:</p>
                                  <div class="progress mb-2" style="height: 10px;">
                                    <div class="progress-bar bg-success" id="rentalConfidenceBar" role="progressbar" style="width: 0%"></div>
                                  </div>
                                  <p class="text-center mb-0" id="rentalConfidence">0%</p>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="card-footer bg-light">
                            <button type="button" class="btn btn-success w-100" id="saveRentalPrediction">
                              <i class="fas fa-save me-2"></i>Simpan & Sewakan ke Pelanggan
                            </button>
                          </div>
                        </div>
                        
                        <!-- No Prediction Info -->
                        <div class="card shadow-sm" id="rentalNoPrediction">
                          <div class="card-body text-center py-5">
                            <div class="empty-state">
                              <i class="fas fa-calendar-alt text-muted mb-3" style="font-size: 4rem;"></i>
                              <h4 class="text-muted">Belum Ada Prediksi Sewa</h4>
                              <p class="text-muted">
                                Masukkan data pada form di samping untuk<br>mendapatkan prediksi harga sewa bulanan.
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Notifikasi -->
        <section id="notifikasi" class="content-section">
          <div class="p-4">
            <h1 class="fw-bold mb-3">Notifikasi</h1>
            <p class="text-muted mb-4">Sistem notifikasi dan peringatan</p>

            <div class="text-center">
              <div class="card shadow-sm border-0">
                <div class="card-body py-5">
                  <i
                    class="fas fa-bell text-muted mb-3"
                    style="font-size: 4rem"
                  ></i>
                  <h4 class="text-muted">Fitur Dalam Pengembangan</h4>
                  <p class="text-muted">
                    Sistem notifikasi akan segera tersedia
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- SheetJS for Excel generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Custom Dashboard JS -->
    <script src="{{ url_for('static', filename='js/dashAdmin.js') }}"></script>
    <script src="{{ url_for('static', filename='js/visualization_handler.js') }}"></script>
    
    <!-- Manajemen Prediksi Harga Aset JS -->
    <script>
      // Global variables for prediction state
      let currentTanahPrediction = null;

      let currentBangunanPrediction = null;
      let rentalPredictionData = null;
      let currentPage = 1;
      let totalPages = 1;

      // Helper function to format currency
      function formatCurrency(amount) {
        return new Intl.NumberFormat('id-ID').format(amount);
      }

      // Initialize page
      document.addEventListener('DOMContentLoaded', function() {
        loadSentAssets();
        loadKecamatanList();
        
        // Init rental prediction form
        if (document.getElementById('rentalPropertyType')) {
          document.getElementById('rentalPropertyType').addEventListener('change', handlePropertyTypeChange);
          
          // Default to hiding bangunan fields
          const bangunanFields = document.getElementById('rentalBangunanFields');
          if (bangunanFields) {
            bangunanFields.style.display = 'none';
          }
        }
        
        // Init rental form submission
        const rentalForm = document.getElementById('rentalPredictionForm');
        if (rentalForm) {
          rentalForm.addEventListener('submit', handleRentalFormSubmit);
        }
        
        // Init save buttons
        const saveTanahBtn = document.getElementById('saveTanahPrediction');
        if (saveTanahBtn) {
          saveTanahBtn.addEventListener('click', saveTanahPrediction);
        }
        
        const saveBangunanBtn = document.getElementById('saveBangunanPrediction');
        if (saveBangunanBtn) {
          saveBangunanBtn.addEventListener('click', saveBangunanPrediction);
        }
        
        const saveRentalBtn = document.getElementById('saveRentalPrediction');
        if (saveRentalBtn) {
          saveRentalBtn.addEventListener('click', saveRentalPrediction);
        }
        
        // Init filter change events
        const filterKecamatan = document.getElementById('filterKecamatan');
        const filterStatus = document.getElementById('filterStatus');
        
        if (filterKecamatan) {
          filterKecamatan.addEventListener('change', function() {
            loadSentAssets(1);
          });
        }
        
        if (filterStatus) {
          filterStatus.addEventListener('change', function() {
            loadSentAssets(1);
          });
        }
      });

      // Load kecamatan list for dropdown filters
      function loadKecamatanList() {
        fetch('/api/kecamatan-list')
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const kecamatanList = data.kecamatans;
              const filterKecamatan = document.getElementById('filterKecamatan');
              
              if (filterKecamatan) {
                // Clear existing options except first one
                while (filterKecamatan.options.length > 1) {
                  filterKecamatan.remove(1);
                }
                
                // Add new options
                kecamatanList.forEach(kecamatan => {
                  const option = document.createElement('option');
                  option.value = kecamatan;
                  option.textContent = kecamatan;
                  filterKecamatan.appendChild(option);
                });
              }
            }
          })
          .catch(error => console.error('Error loading kecamatan list:', error));
      }

      // Load sent assets with pagination
      function loadSentAssets(page = 1) {
        currentPage = page;
        
        const kecamatan = document.getElementById('filterKecamatan')?.value || '';
        const status = document.getElementById('filterStatus')?.value || '';
        
        let url = `/api/prediksi-list?page=${page}&per_page=10`;
        if (kecamatan) url += `&kecamatan=${encodeURIComponent(kecamatan)}`;
        if (status) url += `&status=${encodeURIComponent(status)}`;
        
        fetch(url)
          .then(response => response.json())
          .then(result => {
            if (result.success) {
              displaySentAssets(result.assets);
              updatePagination(result.pagination);
            } else {
              console.error('Error:', result.error);
              const tbody = document.getElementById('sentAssetsTableBody');
              if (tbody) {
                tbody.innerHTML = `<tr><td colspan="7" class="text-center py-4">Error loading data: ${result.error}</td></tr>`;
              }
            }
          })
          .catch(error => {
            console.error('Error:', error);
            const tbody = document.getElementById('sentAssetsTableBody');
            if (tbody) {
              tbody.innerHTML = '<tr><td colspan="7" class="text-center py-4">Error loading data. Please try again.</td></tr>';
            }
          });
      }

      // Display sent assets
      function displaySentAssets(assets) {
        const tbody = document.getElementById('sentAssetsTableBody');
        
        if (!tbody) return;
        
        if (assets.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="text-center py-4">No assets found.</td></tr>';
          return;
        }
        
        let html = '';
        assets.forEach(asset => {
          const statusBadge = getStatusBadge(asset.status);
          
          html += `
            <tr>
              <td>${asset.kecamatan}</td>
              <td>${asset.jenis === 'tanah' ? 'Tanah' : 'Bangunan + Tanah'}</td>
              <td>${asset.luas_tanah_m2} m² ${asset.luas_bangunan_m2 ? `/ ${asset.luas_bangunan_m2} m²` : ''}</td>
              <td>Rp ${formatCurrency(asset.harga_prediksi)}</td>
              <td>Rp ${formatCurrency(asset.harga_sewa || 0)}/bulan</td>
              <td>${statusBadge}</td>
              <td>
                <button class="btn btn-sm btn-outline-primary" onclick="sendToUser(${asset.id})">
                  <i class="fas fa-paper-plane me-1"></i>Kirim ke User
                </button>
              </td>
            </tr>
          `;
        });
        
        tbody.innerHTML = html;
      }

      // Get status badge HTML
      function getStatusBadge(status) {
        switch (status) {
          case 'active':
            return '<span class="badge bg-success">Aktif</span>';
          case 'pending':
            return '<span class="badge bg-warning">Pending</span>';
          case 'expired':
            return '<span class="badge bg-danger">Kadaluarsa</span>';
          default:
            return '<span class="badge bg-secondary">Unknown</span>';
        }
      }

      // Update pagination
      function updatePagination(pagination) {
        totalPages = pagination.total_pages;
        
        // Update info
        const startItem = ((pagination.current_page - 1) * pagination.per_page) + 1;
        const endItem = Math.min(pagination.current_page * pagination.per_page, pagination.total_items);
        
        const paginationInfoEl = document.getElementById('paginationInfo');
        if (paginationInfoEl) {
          paginationInfoEl.textContent = `Menampilkan ${startItem}-${endItem} dari ${pagination.total_items} item`;
        }
        
        // Update pagination buttons
        const paginationList = document.getElementById('paginationList');
        if (!paginationList) return;
        
        let html = '';
        
        // Previous button
        html += `
          <li class="page-item ${pagination.current_page === 1 ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="loadSentAssets(${pagination.current_page - 1}); return false;">
              <i class="fas fa-chevron-left"></i>
            </a>
          </li>
        `;
        
        // Page numbers
        for (let i = 1; i <= pagination.total_pages; i++) {
          html += `
            <li class="page-item ${i === pagination.current_page ? 'active' : ''}">
              <a class="page-link" href="#" onclick="loadSentAssets(${i}); return false;">${i}</a>
            </li>
          `;
        }
        
        // Next button
        html += `
          <li class="page-item ${pagination.current_page === pagination.total_pages ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="loadSentAssets(${pagination.current_page + 1}); return false;">
              <i class="fas fa-chevron-right"></i>
            </a>
          </li>
        `;
        
        paginationList.innerHTML = html;
      }

      // Predict tanah price
      function predictTanahPrice() {
        const form = document.getElementById('tanahForm');
        if (!form) return;
        
        // Check form validity
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }
        
        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => {
          data[key] = value;
        });
        
        // Show loading
        document.getElementById('tanahNoPrediction').style.display = 'none';
        document.getElementById('tanahPredictionResults').style.display = 'block';
        document.getElementById('tanahPredictionContent').innerHTML = `
          <div class="text-center py-5">
            <div class="spinner-border text-danger" role="status"></div>
            <p class="mt-3">Menghitung prediksi harga tanah...</p>
          </div>
        `;
        
        // Make prediction request
        fetch('/api/predict-tanah-all-models', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            currentTanahPrediction = {
              ...result,
              formData: data
            };
            displayTanahPredictionResult(result);
          } else {
            document.getElementById('tanahPredictionContent').innerHTML = `
              <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>Error: ${result.error || 'Failed to predict price'}
              </div>
            `;
          }
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('tanahPredictionContent').innerHTML = `
            <div class="alert alert-danger">
              <i class="fas fa-exclamation-triangle me-2"></i>Error: ${error.message}
            </div>
          `;
        });
      }

      // Display tanah prediction result
      function displayTanahPredictionResult(result) {
        const formData = result.input_data;
        const predictions = result.predictions;
        const confidenceScore = (result.confidence * 100).toFixed(1);
        
        const content = `
          <div class="mb-4">
            <h6 class="text-muted mb-3">Prediksi Berdasarkan Model ML</h6>
            <div class="row g-3">
              <div class="col-md-4">
                <div class="prediction-item">
                  <small class="d-block text-muted mb-1">Random Forest</small>
                  <span class="prediction-value">Rp ${formatCurrency(predictions.random_forest)}</span>
                </div>
              </div>
              <div class="col-md-4">
                <div class="prediction-item">
                  <small class="d-block text-muted mb-1">XGBoost</small>
                  <span class="prediction-value">Rp ${formatCurrency(predictions.xgboost)}</span>
                </div>
              </div>
              <div class="col-md-4">
                <div class="prediction-item">
                  <small class="d-block text-muted mb-1">CatBoost</small>
                  <span class="prediction-value">Rp ${formatCurrency(predictions.catboost)}</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="p-4 bg-light rounded">
            <div class="row">
              <div class="col-md-7">
                <h5 class="mb-0">Prediksi Harga Tanah</h5>
                <div class="text-danger fs-3 fw-bold">Rp ${formatCurrency(result.ensemble_price)}</div>
                <p class="small text-muted mt-2 mb-0">*Ensemble dari 3 model ML</p>
              </div>
              <div class="col-md-5 border-start ps-4">
                <p class="mb-1">Confidence Score:</p>
                <div class="progress mb-2" style="height: 10px;">
                  <div class="progress-bar bg-success" role="progressbar" style="width: ${confidenceScore}%"></div>
                </div>
                <p class="text-center mb-0">${confidenceScore}%</p>
              </div>
            </div>
          </div>
          
          <div class="alert alert-info mt-4">
            <div class="row align-items-center">
              <div class="col-md-2 text-center">
                <i class="fas fa-info-circle fa-2x"></i>
              </div>
              <div class="col-md-10">
                <h6 class="mb-1">Detail Properti</h6>
                <ul class="mb-0">
                  <li>Kecamatan: ${formData.kecamatan}</li>
                  <li>Luas Tanah: ${formData.luas_tanah_m2} m²</li>
                  <li>Jenis Zona: ${formData.jenis_zona}</li>
                  <li>Aksesibilitas: ${formData.aksesibilitas}</li>
                  <li>Tingkat Keamanan: ${formData.tingkat_keamanan}</li>
                </ul>
              </div>
            </div>
          </div>
        `;
        
        document.getElementById('tanahPredictionContent').innerHTML = content;
      }

      // Save tanah prediction
      function saveTanahPrediction() {
        if (!currentTanahPrediction) {
          alert('Tidak ada prediksi untuk disimpan. Silakan lakukan prediksi terlebih dahulu.');
          return;
        }
        
        const btn = document.getElementById('saveTanahPrediction');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Menyimpan...';
        btn.disabled = true;
        
        // Prepare save data
        const saveData = {
          ...currentTanahPrediction.formData,
          ensemble_price: currentTanahPrediction.ensemble_price,
          confidence: currentTanahPrediction.confidence,
          models: currentTanahPrediction.predictions
        };
        
        fetch('/api/save-tanah-prediction', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(saveData)
        })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            alert('Prediksi berhasil disimpan dan siap untuk disewakan ke pelanggan.');
            
            // Reload sent assets list
            loadSentAssets();
            
            // Reset form and prediction
            document.getElementById('tanahForm').reset();
            document.getElementById('tanahPredictionResults').style.display = 'none';
            document.getElementById('tanahNoPrediction').style.display = 'block';
            currentTanahPrediction = null;
            
            // Switch to sent assets tab
            const sentAssetsTab = document.getElementById('sent-assets-tab');
            if (sentAssetsTab) {
              sentAssetsTab.click();
            }
          } else {
            alert('Error: ' + (result.error || 'Failed to save prediction'));
          }
        })
        .catch(error => {
          alert('Error: ' + error.message);
        })
        .finally(() => {
          btn.innerHTML = originalText;
          btn.disabled = false;
        });
      }

      // Predict bangunan price
      function predictBangunanPrice() {
        const form = document.getElementById('bangunanForm');
        if (!form) return;
        
        // Check form validity
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }
        
        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => {
          data[key] = value;
        });
        
        // Show loading
        document.getElementById('bangunanNoPrediction').style.display = 'none';
        document.getElementById('bangunanPredictionResults').style.display = 'block';
        document.getElementById('bangunanPredictionContent').innerHTML = `
          <div class="text-center py-5">
            <div class="spinner-border text-danger" role="status"></div>
            <p class="mt-3">Menghitung prediksi harga bangunan + tanah...</p>
          </div>
        `;
        
        // Make prediction request
        fetch('/api/predict-tanah-all-models', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            currentBangunanPrediction = {
              ...result,
              formData: data
            };
            displayBangunanPredictionResult(result);
          } else {
            document.getElementById('bangunanPredictionContent').innerHTML = `
              <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>Error: ${result.error || 'Failed to predict price'}
              </div>
            `;
          }
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('bangunanPredictionContent').innerHTML = `
            <div class="alert alert-danger">
              <i class="fas fa-exclamation-triangle me-2"></i>Error: ${error.message}
            </div>
          `;
        });
      }

      // Display bangunan prediction result
      function displayBangunanPredictionResult(result) {
        const formData = result.input_data;
        const predictions = result.predictions;
        const confidenceScore = (result.confidence * 100).toFixed(1);
        
        const content = `
          <div class="mb-4">
            <h6 class="text-muted mb-3">Prediksi Berdasarkan Model ML</h6>
            <div class="row g-3">
              <div class="col-md-4">
                <div class="prediction-item">
                  <small class="d-block text-muted mb-1">Random Forest</small>
                  <span class="prediction-value">Rp ${formatCurrency(predictions.random_forest)}</span>
                </div>
              </div>
              <div class="col-md-4">
                <div class="prediction-item">
                  <small class="d-block text-muted mb-1">XGBoost</small>
                  <span class="prediction-value">Rp ${formatCurrency(predictions.xgboost)}</span>
                </div>
              </div>
              <div class="col-md-4">
                <div class="prediction-item">
                  <small class="d-block text-muted mb-1">CatBoost</small>
                  <span class="prediction-value">Rp ${formatCurrency(predictions.catboost)}</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="p-4 bg-light rounded">
            <div class="row">
              <div class="col-md-7">
                <h5 class="mb-0">Prediksi Harga Bangunan + Tanah</h5>
                <div class="text-danger fs-3 fw-bold">Rp ${formatCurrency(result.ensemble_price)}</div>
                <p class="small text-muted mt-2 mb-0">*Ensemble dari 3 model ML</p>
              </div>
              <div class="col-md-5 border-start ps-4">
                <p class="mb-1">Confidence Score:</p>
                <div class="progress mb-2" style="height: 10px;">
                  <div class="progress-bar bg-success" role="progressbar" style="width: ${confidenceScore}%"></div>
                </div>
                <p class="text-center mb-0">${confidenceScore}%</p>
              </div>
            </div>
          </div>
          
          <div class="alert alert-info mt-4">
            <div class="row align-items-center">
              <div class="col-md-2 text-center">
                <i class="fas fa-info-circle fa-2x"></i>
              </div>
              <div class="col-md-10">
                <h6 class="mb-1">Detail Properti</h6>
                <ul class="mb-0">
                  <li>Kecamatan: ${formData.kecamatan}</li>
                  <li>Luas Tanah: ${formData.luas_tanah_m2} m²</li>
                  <li>Luas Bangunan: ${formData.luas_bangunan_m2} m²</li>
                  <li>Kamar Tidur: ${formData.jumlah_kamar}</li>
                  <li>Kamar Mandi: ${formData.jumlah_kamar_mandi}</li>
                  <li>Kondisi: ${formData.kondisi_properti}</li>
                </ul>
              </div>
            </div>
          </div>
        `;
        
        document.getElementById('bangunanPredictionContent').innerHTML = content;
      }

      // Save bangunan prediction
      function saveBangunanPrediction() {
        if (!currentBangunanPrediction) {
          alert('Tidak ada prediksi untuk disimpan. Silakan lakukan prediksi terlebih dahulu.');
          return;
        }
        
        const btn = document.getElementById('saveBangunanPrediction');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Menyimpan...';
        btn.disabled = true;
        
        // Prepare save data
        const saveData = {
          ...currentBangunanPrediction.formData,
          ensemble_price: currentBangunanPrediction.ensemble_price,
          confidence: currentBangunanPrediction.confidence,
          models: currentBangunanPrediction.predictions
        };
        
        fetch('/api/save-tanah-prediction', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(saveData)
        })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            alert('Prediksi berhasil disimpan dan siap untuk disewakan ke pelanggan.');
            
            // Reload sent assets list
            loadSentAssets();
            
            // Reset form and prediction
            document.getElementById('bangunanForm').reset();
            document.getElementById('bangunanPredictionResults').style.display = 'none';
            document.getElementById('bangunanNoPrediction').style.display = 'block';
            currentBangunanPrediction = null;
            
            // Switch to sent assets tab
            const sentAssetsTab = document.getElementById('sent-assets-tab');
            if (sentAssetsTab) {
              sentAssetsTab.click();
            }
          } else {
            alert('Error: ' + (result.error || 'Failed to save prediction'));
          }
        })
        .catch(error => {
          alert('Error: ' + error.message);
        })
        .finally(() => {
          btn.innerHTML = originalText;
          btn.disabled = false;
        });
      }

      // Send asset to user
      function sendToUser(assetId) {
        if (!confirm('Apakah Anda yakin ingin mengirim aset ini ke user?')) {
          return;
        }
        
        fetch(`/api/send-to-user/${assetId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            alert('Aset berhasil dikirim ke user.');
            loadSentAssets(currentPage);
          } else {
            alert('Error: ' + (result.error || 'Failed to send asset to user'));
          }
        })
        .catch(error => {
          alert('Error: ' + error.message);
        });
      }

      // Handle property type change for rental prediction
      function handlePropertyTypeChange() {
        const propertyType = this.value;
        const bangunanFields = document.getElementById('rentalBangunanFields');
        const luasBangunanGroup = document.getElementById('rentalLuasBangunanGroup');
        const dayaListrikGroup = document.getElementById('rentalDayaListrikGroup');
        
        if (!bangunanFields) return;
        
        if (propertyType === 'tanah') {
          bangunanFields.style.display = 'none';
          document.getElementById('rentalDayaListrik').value = '900';
          document.getElementById('rentalLuasBangunan').removeAttribute('required');
          document.getElementById('rentalKondisiProperti').removeAttribute('required');
          document.getElementById('rentalDayaListrik').removeAttribute('required');
        } else {
          bangunanFields.style.display = 'block';
          document.getElementById('rentalLuasBangunan').setAttribute('required', 'required');
          document.getElementById('rentalKondisiProperti').setAttribute('required', 'required');
          document.getElementById('rentalDayaListrik').setAttribute('required', 'required');
        }
      }

      // Handle rental form submission
      function handleRentalFormSubmit(e) {
        e.preventDefault();
        
        const form = e.target;
        
        // Check form validity
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }
        
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        
        // Show loading state
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Memproses...';
        submitBtn.disabled = true;
        
        // Hide previous results
        document.getElementById('rentalPredictionResults').style.display = 'none';
        document.getElementById('rentalNoPrediction').style.display = 'block';
        
        // Make prediction request
        fetch('/api/predict-rental-price', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            rentalPredictionData = {
              ...result,
              formData: data
            };
            displayRentalPredictionResults(result);
            
            // Hide the no prediction section and show results
            document.getElementById('rentalNoPrediction').style.display = 'none';
            document.getElementById('rentalPredictionResults').style.display = 'block';
          } else {
            alert('Error: ' + (result.error || 'Failed to predict rental price'));
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error: ' + error.message);
        })
        .finally(() => {
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        });
      }

      // Display rental prediction results
      function displayRentalPredictionResults(result) {
        // Update result displays
        document.getElementById('rentalRfResult').textContent = 'Rp ' + formatCurrency(result.predictions.random_forest);
        document.getElementById('rentalXgbResult').textContent = 'Rp ' + formatCurrency(result.predictions.xgboost);
        document.getElementById('rentalCatResult').textContent = 'Rp ' + formatCurrency(result.predictions.catboost);
        document.getElementById('rentalEnsembleResult').textContent = 'Rp ' + formatCurrency(result.ensemble_price);
        
        const confidence = (result.confidence * 100).toFixed(1);
        document.getElementById('rentalConfidence').textContent = confidence + '%';
        document.getElementById('rentalConfidenceBar').style.width = confidence + '%';
        
        // Scroll to results
        document.getElementById('rentalPredictionResults').scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }

      // Save rental prediction
      function saveRentalPrediction() {
        if (!rentalPredictionData) {
          alert('Tidak ada prediksi untuk disimpan. Silakan lakukan prediksi terlebih dahulu.');
          return;
        }
        
        const btn = document.getElementById('saveRentalPrediction');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Menyimpan...';
        btn.disabled = true;
        
        // Prepare save data
        const saveData = {
          ...rentalPredictionData.formData,
          ensemble_price: rentalPredictionData.ensemble_price,
          confidence: rentalPredictionData.confidence,
          models: rentalPredictionData.predictions
        };
        
        fetch('/api/save-rental-prediction', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(saveData)
        })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            alert('Prediksi harga sewa berhasil disimpan dan siap untuk disewakan ke pelanggan.');
            
            // Reload sent assets list
            loadSentAssets();
            
            // Reset form and prediction
            document.getElementById('rentalPredictionForm').reset();
            document.getElementById('rentalPredictionResults').style.display = 'none';
            document.getElementById('rentalNoPrediction').style.display = 'block';
            rentalPredictionData = null;
            
            // Switch to sent assets tab
            const sentAssetsTab = document.getElementById('sent-assets-tab');
            if (sentAssetsTab) {
              sentAssetsTab.click();
            }
          } else {
            alert('Error: ' + (result.error || 'Failed to save rental prediction'));
          }
        })
        .catch(error => {
          alert('Error: ' + error.message);
        })
        .finally(() => {
          btn.innerHTML = originalText;
          btn.disabled = false;
        });
      }
    </script>
  </body>
</html>
